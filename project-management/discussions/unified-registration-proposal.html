<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Discussion: Unified Registration Flow Proposal</title>
    <style>
        :root {
            --color-bg: #1a1a1a;
            --color-surface: #2d2d2d;
            --color-border: #404040;
            --color-text: #e0e0e0;
            --color-text-dim: #a0a0a0;
            --color-accent-blue: #4a9eff;
            --color-accent-purple: #b794f4;
            --color-accent-green: #48bb78;
            --color-accent-orange: #f6ad55;
            --color-accent-red: #fc8181;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--color-accent-blue);
            font-size: 2em;
            margin-bottom: 10px;
        }

        .meta {
            color: var(--color-text-dim);
            font-size: 0.9em;
        }

        .context {
            background: var(--color-surface);
            border-left: 4px solid var(--color-accent-purple);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 4px;
        }

        .context h2 {
            color: var(--color-accent-purple);
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .context-section {
            margin-bottom: 20px;
        }

        .context-section h3 {
            color: var(--color-accent-blue);
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .context-section ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .context-section li {
            margin-bottom: 5px;
        }

        .code-block {
            background: #1a1a1a;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            overflow-x: auto;
        }

        .message {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--color-border);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            font-size: 1.2em;
        }

        .agent-developer { background: var(--color-accent-blue); }
        .agent-security { background: var(--color-accent-red); }
        .agent-ux { background: var(--color-accent-green); }
        .agent-qa { background: var(--color-accent-orange); }
        .agent-orchestrator { background: var(--color-accent-purple); }

        .message-info {
            flex: 1;
        }

        .agent-name {
            font-weight: bold;
            font-size: 1.1em;
        }

        .timestamp {
            color: var(--color-text-dim);
            font-size: 0.85em;
        }

        .message-content {
            color: var(--color-text);
        }

        .message-content h4 {
            color: var(--color-accent-blue);
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .message-content ul, .message-content ol {
            margin-left: 20px;
            margin-top: 8px;
        }

        .message-content li {
            margin-bottom: 6px;
        }

        .message-content strong {
            color: var(--color-accent-blue);
        }

        .recommendation {
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.1), rgba(183, 148, 244, 0.1));
            border: 2px solid var(--color-accent-purple);
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
        }

        .recommendation h2 {
            color: var(--color-accent-purple);
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .pros, .cons {
            background: var(--color-surface);
            padding: 15px;
            border-radius: 6px;
        }

        .pros h4 {
            color: var(--color-accent-green);
            margin-bottom: 10px;
        }

        .cons h4 {
            color: var(--color-accent-orange);
            margin-bottom: 10px;
        }

        .decision-box {
            background: var(--color-surface);
            border-left: 4px solid var(--color-accent-green);
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
        }

        .warning-box {
            background: var(--color-surface);
            border-left: 4px solid var(--color-accent-orange);
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
        }

        .comparison-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        .comparison-table th, .comparison-table td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid var(--color-border);
        }

        .comparison-table th {
            color: var(--color-accent-blue);
        }

        @media (max-width: 768px) {
            .pros-cons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Unified Registration Flow Proposal</h1>
        <div class="meta">
            Discussion Date: December 17, 2025<br>
            Topic: Remove "subsequent user" flow - one registration flow with full setup, team members via invite only<br>
            Participants: Senior Next.js Developer, Security Architect, UX Advocate (TRON), QA Architect, Project Orchestrator
        </div>
    </header>

    <div class="context">
        <h2>Context & Proposal</h2>

        <div class="context-section">
            <h3>Current Problem</h3>
            <ul>
                <li>Two registration flows exist: "first user" (full setup) and "subsequent user" (simplified)</li>
                <li>The frontend uses a flawed check (<code>auth.me === null</code>) to determine which flow to show</li>
                <li>This check always returns null for unauthenticated users, causing confusion</li>
                <li>Race conditions in parallel E2E tests cause teamspace creation conflicts</li>
                <li>The "subsequent user" flow is architecturally problematic</li>
            </ul>
        </div>

        <div class="context-section">
            <h3>User's Proposal</h3>
            <ul>
                <li><strong>Remove the "subsequent user" registration flow entirely</strong></li>
                <li><strong>ONE registration flow</strong> that always includes full setup:
                    <ul>
                        <li>Account creation (email, password, name)</li>
                        <li>Teamspace creation (in multi-tenant mode)</li>
                        <li>Channel creation (always)</li>
                    </ul>
                </li>
                <li><strong>Future: Invite flow</strong> for adding team members
                    <ul>
                        <li>Magic link invitation system</li>
                        <li>Invited users create accounts but are auto-enrolled in the inviter's teamspace/channel</li>
                        <li>No option to create their own teamspace/channel</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="context-section">
            <h3>Key Questions to Address</h3>
            <ul>
                <li>Is this pattern common in SaaS applications?</li>
                <li>What are the security implications?</li>
                <li>How does this affect single-tenant vs multi-tenant modes?</li>
                <li>What should happen to the existing "open registration" capability?</li>
                <li>Implementation complexity and timeline?</li>
            </ul>
        </div>
    </div>

    <div class="message">
        <div class="message-header">
            <div class="avatar agent-orchestrator">&#127919;</div>
            <div class="message-info">
                <div class="agent-name">Project Orchestrator</div>
                <div class="timestamp">09:00 AM</div>
            </div>
        </div>
        <div class="message-content">
            <p>Good morning, team. The user has proposed a significant simplification to our registration architecture. Currently, we have a hybrid model: anyone can register, and the first user gets extra setup steps while subsequent users get a simplified flow.</p>

            <p>The proposal is to eliminate this complexity entirely:</p>
            <ol>
                <li><strong>Public registration always creates a new workspace</strong> (teamspace + channel)</li>
                <li><strong>Team members are added via invitation only</strong> (future feature)</li>
            </ol>

            <p>This is actually a very common pattern in SaaS applications. Let's examine this from all angles - technical feasibility, security, UX, testing, and industry best practices.</p>
        </div>
    </div>

    <div class="message">
        <div class="message-header">
            <div class="avatar agent-developer">&#128187;</div>
            <div class="message-info">
                <div class="agent-name">Senior Next.js Developer</div>
                <div class="timestamp">09:15 AM</div>
            </div>
        </div>
        <div class="message-content">
            <h4>Industry Best Practices Analysis</h4>

            <p>I've analyzed how major SaaS applications handle registration, and this proposal aligns with industry standards:</p>

            <table class="comparison-table">
                <tr>
                    <th>Application</th>
                    <th>Registration Creates</th>
                    <th>Team Members Added Via</th>
                </tr>
                <tr>
                    <td><strong>Slack</strong></td>
                    <td>New workspace</td>
                    <td>Invite link / email invite</td>
                </tr>
                <tr>
                    <td><strong>Notion</strong></td>
                    <td>New workspace</td>
                    <td>Invite link / email invite</td>
                </tr>
                <tr>
                    <td><strong>Linear</strong></td>
                    <td>New workspace</td>
                    <td>Invite link / email invite</td>
                </tr>
                <tr>
                    <td><strong>Figma</strong></td>
                    <td>Personal workspace + optional team</td>
                    <td>Invite to team</td>
                </tr>
                <tr>
                    <td><strong>Discord</strong></td>
                    <td>Account (servers are separate)</td>
                    <td>Server invite links</td>
                </tr>
                <tr>
                    <td><strong>GitHub</strong></td>
                    <td>Personal account</td>
                    <td>Org/repo invite</td>
                </tr>
            </table>

            <h4>Common Pattern:</h4>
            <ul>
                <li><strong>Registration = Create your own space</strong></li>
                <li><strong>Joining = Via explicit invitation</strong></li>
                <li>This prevents "squatting" on existing workspaces</li>
                <li>Clear ownership and permission boundaries</li>
            </ul>

            <h4>Technical Implementation:</h4>
            <p>This actually <strong>simplifies</strong> our codebase significantly:</p>

            <div class="code-block">
// BEFORE: Complex conditional logic
const isFirstUser = /* flawed check */;
if (isFirstUser) {
  // Show channel creation step
} else {
  // Skip channel creation, auto-join existing
}

// AFTER: Simple, consistent flow
// Registration ALWAYS creates workspace
// Team members use /invite/:token flow (future)
            </div>

            <h4>Files to Modify:</h4>
            <ul>
                <li><code>src/app/(auth)/register/page.tsx</code> - Remove conditional logic, always show full setup</li>
                <li><code>src/server/trpc/routers/auth.ts</code> - Simplify register mutation</li>
                <li><code>e2e/helpers/auth.ts</code> - Remove first-user vs subsequent-user handling</li>
                <li><code>e2e/global-setup.ts</code> - No longer need to seed teamspace for tests</li>
            </ul>

            <p><strong>Verdict:</strong> This is the industry-standard approach and will significantly reduce code complexity. Strong support.</p>
        </div>
    </div>

    <div class="message">
        <div class="message-header">
            <div class="avatar agent-security">&#128274;</div>
            <div class="message-info">
                <div class="agent-name">Security Architect</div>
                <div class="timestamp">09:35 AM</div>
            </div>
        </div>
        <div class="message-content">
            <h4>Security Analysis</h4>

            <p>From a security perspective, this proposal is <strong>significantly more secure</strong> than the current approach.</p>

            <h4>Current Security Issues:</h4>
            <ul>
                <li><strong>Open Registration to Existing Workspace:</strong> Anyone who finds the app can register and auto-join an existing workspace as "editor"</li>
                <li><strong>No Authorization Check:</strong> The "subsequent user" flow doesn't verify if the user should have access</li>
                <li><strong>Implicit Trust:</strong> Assumes all registrations are legitimate team members</li>
                <li><strong>Data Exposure Risk:</strong> Malicious users could access private video scripts</li>
            </ul>

            <h4>Proposed Model Security Benefits:</h4>
            <ul>
                <li><strong>Explicit Authorization:</strong> Only invited users can join a workspace</li>
                <li><strong>No Accidental Access:</strong> Registration creates isolated workspace</li>
                <li><strong>Audit Trail:</strong> Invitations create clear record of who granted access</li>
                <li><strong>Revocable Access:</strong> Owners can revoke invitations before they're used</li>
            </ul>

            <h4>Magic Link Security Considerations (Future):</h4>
            <div class="warning-box">
                <h4 style="color: var(--color-accent-orange);">&#9888; Implementation Requirements</h4>
                <ul>
                    <li><strong>Token entropy:</strong> Minimum 256-bit random tokens</li>
                    <li><strong>Token expiry:</strong> 48-72 hours maximum</li>
                    <li><strong>Single use:</strong> Tokens invalidated after use</li>
                    <li><strong>HTTPS only:</strong> Never send tokens over HTTP</li>
                    <li><strong>Rate limiting:</strong> Limit invitation sends per user/hour</li>
                    <li><strong>Email verification:</strong> Only send to valid email addresses</li>
                </ul>
            </div>

            <h4>Single-Tenant Mode Consideration:</h4>
            <p>In single-tenant mode (self-hosted), the admin might want to allow open registration. We should provide a configuration option:</p>
            <div class="code-block">
// .env options:
REGISTRATION_MODE=invite-only  // Default: Only invited users can join
REGISTRATION_MODE=open         // Anyone can register and join default workspace
            </div>

            <p><strong>Verdict:</strong> Strong security improvement. The current "auto-join" behavior is a security anti-pattern. Recommend proceeding with invite-only as default, with optional open mode for single-tenant deployments.</p>
        </div>
    </div>

    <div class="message">
        <div class="message-header">
            <div class="avatar agent-ux">&#127912;</div>
            <div class="message-info">
                <div class="agent-name">TRON (UX Advocate)</div>
                <div class="timestamp">09:55 AM</div>
            </div>
        </div>
        <div class="message-content">
            <h4>User Experience Analysis</h4>

            <p>This proposal creates <strong>much clearer mental models</strong> for users.</p>

            <h4>Current Confusion Points:</h4>
            <ul>
                <li>"I registered but I don't see my colleague's projects" - User expected to join existing workspace</li>
                <li>"Why did it ask for a channel name for me but not my teammate?" - Inconsistent experience</li>
                <li>"How do I add someone to my workspace?" - No clear path</li>
            </ul>

            <h4>Proposed User Journey:</h4>

            <h4>1. New User (Creating Workspace):</h4>
            <ol>
                <li>Land on marketing page or direct to /register</li>
                <li>Create account (email, password, name)</li>
                <li>Create their workspace:
                    <ul>
                        <li>"What should we call your workspace?" (teamspace name)</li>
                        <li>"Name your first channel" (channel name)</li>
                    </ul>
                </li>
                <li>Arrive at empty dashboard with onboarding</li>
                <li>Clear CTA: "Invite team members" in settings</li>
            </ol>

            <h4>2. Invited User (Joining Workspace):</h4>
            <ol>
                <li>Receive email: "Alex invited you to join Acme Studios"</li>
                <li>Click magic link</li>
                <li>Create account (email pre-filled, just set password + name)</li>
                <li>Automatically enrolled in inviter's workspace</li>
                <li>Arrive at populated dashboard</li>
            </ol>

            <h4>UX Improvements:</h4>
            <ul>
                <li><strong>Clear mental model:</strong> "Register = Create your own space"</li>
                <li><strong>Intentional collaboration:</strong> "Join = Accept an invitation"</li>
                <li><strong>No surprises:</strong> Users know what they're getting</li>
                <li><strong>Progressive disclosure:</strong> Invite flow is for later, not during onboarding</li>
            </ul>

            <h4>Copy Suggestions:</h4>
            <div class="code-block">
// Registration page
"Create your workspace"
"Get started with Streamline Studio - your personal video planning hub"

// Invite email
"You've been invited to join [Workspace Name]"
"Alex wants you to collaborate on their video projects"

// Invite landing page
"Join [Workspace Name]"
"Create your account to start collaborating with [Inviter Name]"
            </div>

            <h4>Edge Case: What if someone registers thinking they'd join existing?</h4>
            <p>Add help text on registration page:</p>
            <div class="code-block">
"Looking to join an existing workspace? Ask your team admin to send you an invite."
            </div>

            <p><strong>Verdict:</strong> Strong UX improvement. This removes ambiguity and sets clear expectations. Users will understand the difference between "create" and "join" pathways.</p>
        </div>
    </div>

    <div class="message">
        <div class="message-header">
            <div class="avatar agent-qa">&#129514;</div>
            <div class="message-info">
                <div class="agent-name">QA Architect</div>
                <div class="timestamp">10:15 AM</div>
            </div>
        </div>
        <div class="message-content">
            <h4>Testing & Quality Implications</h4>

            <p>This proposal <strong>dramatically simplifies testing</strong>.</p>

            <h4>Current Testing Complexity:</h4>
            <ul>
                <li>Must test first-user flow (with channel creation)</li>
                <li>Must test subsequent-user flow (auto-join)</li>
                <li>Must seed teamspace in global-setup to avoid race conditions</li>
                <li>Must handle flaky "first user" detection</li>
                <li>Complex fixture logic in <code>e2e/helpers/auth.ts</code></li>
            </ul>

            <h4>Simplified Testing:</h4>
            <ul>
                <li><strong>One registration flow:</strong> Always creates workspace</li>
                <li><strong>No seeding required:</strong> Each test creates isolated workspace</li>
                <li><strong>No race conditions:</strong> Parallel tests don't share state</li>
                <li><strong>Simpler fixtures:</strong> Just register, always get a workspace</li>
            </ul>

            <h4>Test Scenarios (Simplified):</h4>
            <table class="comparison-table">
                <tr>
                    <th>Scenario</th>
                    <th>Before</th>
                    <th>After</th>
                </tr>
                <tr>
                    <td>Registration</td>
                    <td>2 flows (first/subsequent)</td>
                    <td>1 flow</td>
                </tr>
                <tr>
                    <td>E2E Test Isolation</td>
                    <td>Shared teamspace, race conditions</td>
                    <td>Isolated workspaces, no conflicts</td>
                </tr>
                <tr>
                    <td>Global Setup</td>
                    <td>Must seed teamspace</td>
                    <td>Just validate environment</td>
                </tr>
                <tr>
                    <td>Auth Helper</td>
                    <td>~50 lines with conditionals</td>
                    <td>~20 lines, simple</td>
                </tr>
            </table>

            <h4>New Tests Needed (Future - Invite Flow):</h4>
            <ul>
                <li>Invite creation (admin only)</li>
                <li>Invite email sending</li>
                <li>Invite token validation</li>
                <li>Invite expiry</li>
                <li>Invite acceptance flow</li>
                <li>Invited user permissions</li>
            </ul>

            <h4>Immediate Benefit:</h4>
            <p>Our current E2E flakiness (3-4 failures per run) should <strong>drop to near zero</strong> because:</p>
            <ul>
                <li>No "first user" detection race condition</li>
                <li>No teamspace slug collision</li>
                <li>Each test is fully isolated</li>
            </ul>

            <p><strong>Verdict:</strong> Strong support. This directly addresses the CI test reliability issues we've been fighting. The invite flow tests can be added when that feature is implemented.</p>
        </div>
    </div>

    <div class="message">
        <div class="message-header">
            <div class="avatar agent-developer">&#128187;</div>
            <div class="message-info">
                <div class="agent-name">Senior Next.js Developer</div>
                <div class="timestamp">10:35 AM</div>
            </div>
        </div>
        <div class="message-content">
            <h4>Single-Tenant vs Multi-Tenant Considerations</h4>

            <p>Let me clarify how this affects our two deployment modes:</p>

            <h4>Multi-Tenant Mode (SaaS):</h4>
            <ul>
                <li>Each registration creates a new teamspace</li>
                <li>Complete isolation between customers</li>
                <li>Invite-only for team members</li>
                <li><strong>This is standard SaaS behavior</strong> - no changes needed</li>
            </ul>

            <h4>Single-Tenant Mode (Self-Hosted):</h4>
            <p>This is where it gets interesting. We have options:</p>

            <h4>Option A: Same as Multi-Tenant (Recommended)</h4>
            <ul>
                <li>Each registration creates workspace</li>
                <li>First user is admin, can invite others</li>
                <li>Clear ownership model</li>
                <li>Most secure default</li>
            </ul>

            <h4>Option B: Open Registration (Configurable)</h4>
            <ul>
                <li>First user creates default workspace</li>
                <li>Subsequent users auto-join as editors</li>
                <li>Useful for small teams without invite workflow</li>
                <li>Must be explicitly enabled via env var</li>
            </ul>

            <h4>Proposed Configuration:</h4>
            <div class="code-block">
# Default: Invite-only (secure)
REGISTRATION_MODE=invite-only

# Optional: Open registration (legacy behavior)
REGISTRATION_MODE=open
            </div>

            <h4>Important Distinction:</h4>
            <p>Even in <code>open</code> mode, I'd argue against the current "subsequent user" flow. Instead:</p>
            <ul>
                <li><strong>Open mode:</strong> Registration still creates full workspace, but app shows "join existing workspace" option prominently</li>
                <li>This gives users explicit choice rather than magic auto-joining</li>
            </ul>

            <p><strong>Verdict:</strong> For MVP, implement invite-only as the only option. Add open mode later if there's demand from self-hosted users.</p>
        </div>
    </div>

    <div class="message">
        <div class="message-header">
            <div class="avatar agent-orchestrator">&#127919;</div>
            <div class="message-info">
                <div class="agent-name">Project Orchestrator</div>
                <div class="timestamp">10:55 AM</div>
            </div>
        </div>
        <div class="message-content">
            <h4>Summary of Consensus</h4>

            <p>We have <strong>unanimous support</strong> for the user's proposal. Let me summarize:</p>

            <div class="pros-cons">
                <div class="pros">
                    <h4>Benefits (All Agents Agree)</h4>
                    <ul>
                        <li>Industry-standard pattern (Slack, Notion, Linear)</li>
                        <li>Significantly improved security</li>
                        <li>Clearer UX mental model</li>
                        <li>Dramatically simpler testing</li>
                        <li>Eliminates CI flakiness</li>
                        <li>Reduced code complexity</li>
                        <li>Pre-1.0 status allows clean break</li>
                    </ul>
                </div>
                <div class="cons">
                    <h4>Considerations</h4>
                    <ul>
                        <li>Invite flow not yet implemented (future work)</li>
                        <li>Single-tenant users may want open mode (defer)</li>
                        <li>Need to communicate change in UI copy</li>
                        <li>Existing users unaffected (no migration)</li>
                    </ul>
                </div>
            </div>

            <h4>Implementation Phasing:</h4>
            <ol>
                <li><strong>Phase 1 (Immediate):</strong> Remove subsequent-user flow
                    <ul>
                        <li>Registration always creates full workspace (teamspace + channel)</li>
                        <li>Remove conditional logic from frontend</li>
                        <li>Simplify auth router</li>
                        <li>Update E2E tests</li>
                    </ul>
                </li>
                <li><strong>Phase 2 (Future):</strong> Implement invite flow
                    <ul>
                        <li>Magic link invitation system</li>
                        <li>Invited users bypass workspace creation</li>
                        <li>Permission management for invites</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <div class="recommendation">
        <h2>Final Recommendation: APPROVE</h2>

        <p><strong>Decision:</strong> Proceed with removing the "subsequent user" registration flow. All new registrations will create their own workspace (teamspace + channel). Team member invitations will be implemented as a future feature.</p>

        <div class="decision-box">
            <h3 style="color: var(--color-accent-green); margin-bottom: 15px;">Phase 1 Implementation Plan</h3>

            <h4>1. Frontend Changes</h4>
            <ul>
                <li>Remove <code>isFirstUser</code> state and conditional logic from <code>/register</code></li>
                <li>Always show full setup flow (Account + Channel creation)</li>
                <li>Update copy: "Create your workspace" instead of "Create Account"</li>
                <li>Add help text: "Looking to join an existing workspace? Ask for an invite."</li>
            </ul>

            <h4>2. Backend Changes</h4>
            <ul>
                <li>Simplify <code>auth.register</code> mutation - always create teamspace + channel</li>
                <li>Remove first-user detection logic</li>
                <li>Ensure channel name is required (no longer optional)</li>
            </ul>

            <h4>3. E2E Test Changes</h4>
            <ul>
                <li>Simplify <code>e2e/helpers/auth.ts</code> - remove conditional flow handling</li>
                <li>Remove teamspace seeding from <code>global-setup.ts</code></li>
                <li>Each test creates isolated workspace</li>
                <li>Update preferences tests to expect consistent flow</li>
            </ul>

            <h4>4. Cleanup</h4>
            <ul>
                <li>Remove any remaining <code>isFirstUser</code> checks</li>
                <li>Remove setup flag file system if still present</li>
                <li>Update documentation</li>
            </ul>
        </div>

        <div class="warning-box">
            <h3 style="color: var(--color-accent-orange); margin-bottom: 15px;">Phase 2 (Future): Invite Flow</h3>
            <p>To be implemented when needed. Key features:</p>
            <ul>
                <li>Admin can generate invite links</li>
                <li>Magic link with secure token (256-bit, 48hr expiry, single-use)</li>
                <li>Invited user creates account with pre-selected workspace</li>
                <li>No workspace/channel creation UI for invited users</li>
                <li>Automatic enrollment with specified role</li>
            </ul>

            <h4 style="color: var(--color-accent-blue); margin-top: 20px; margin-bottom: 10px;">Invite Link Dual-Path Flow</h4>
            <p>Invite links should support <strong>both new and existing users</strong>:</p>
            <ul>
                <li><strong>New User Path:</strong> Create account → Auto-enroll in invited teamspace</li>
                <li><strong>Existing User Path:</strong> Log in → Teamspace added to their account</li>
            </ul>
            <p>This handles scenarios where a user already has their own workspace but is invited to collaborate on another.</p>

            <h4 style="color: var(--color-accent-blue); margin-top: 20px; margin-bottom: 10px;">Single-Tenant Mode Messaging</h4>
            <p>Clear messaging required on registration and invite pages in single-tenant mode:</p>
            <div class="code-block" style="margin-top: 10px;">
// Registration page (single-tenant)
"This is a self-hosted instance of Streamline Studio.
Your account is local to this server and is not connected
to any cloud-hosted Streamline Studio service."

// Invite team members page (single-tenant)
"Team members you invite will create accounts on this
self-hosted instance. These accounts are local only and
are not connected to the cloud-hosted solution."
            </div>
            <p>This prevents confusion when users expect SSO or account portability between self-hosted and cloud versions.</p>
        </div>

        <h3 style="color: var(--color-accent-blue); margin-top: 20px; margin-bottom: 10px;">Success Criteria</h3>
        <ul>
            <li>All registrations create new workspace (no auto-join)</li>
            <li>E2E tests pass consistently without teamspace seeding</li>
            <li>Clear UX messaging about creating vs joining</li>
            <li>No regression in existing functionality</li>
            <li>CI tests no longer flaky due to registration race conditions</li>
        </ul>

        <h3 style="color: var(--color-accent-purple); margin-top: 20px; margin-bottom: 10px;">Expected Impact</h3>
        <ul>
            <li><strong>Code Reduction:</strong> ~30-40% less registration code</li>
            <li><strong>Test Reliability:</strong> Near-zero flakiness from registration tests</li>
            <li><strong>Security:</strong> No unauthorized auto-join to workspaces</li>
            <li><strong>UX:</strong> Clear, consistent user expectations</li>
        </ul>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--color-border); text-align: center; color: var(--color-text-dim);">
        <p>Generated by Project Orchestrator | Streamline Studio | December 17, 2025</p>
    </footer>
</body>
</html>
